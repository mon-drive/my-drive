
    <style>
    .btn-toggle {
      width: 100%;
      padding: 20px;
      font-size: 18px;
      text-align: center;
      border: 2px solid #007bff;
      border-radius: 0.375rem;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .btn-toggle.active {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }

    .btn-toggle:hover {
      background-color: #0056b3;
      color: white;
    }

    .btn-toggle .price {
      display: block;
      font-size: 24px;
      font-weight: bold;
    }

    .btn-separator {
      border-left: 2px solid #333;
      height: 100%;
    }
  </style>
  <div class="container mt-4">
    <div class="row">
      <!-- Parte sinistra: Dati di pagamento -->
      <div class="col-md-8">
        <h2>Pagamento</h2>
        <!-- Selezione del piano e frequenza -->
        <div class="mb-3">
          <h4>Seleziona la frequenza di pagamento</h4>
          <div class="d-flex">
            <div class="btn-toggle" id="monthly_btn" data-value="monthly">
              Fatturazione Mensile
              <span class="price">9.99€</span>
            </div>
            <div class="btn-separator"></div>
            <div class="btn-toggle" id="annual_btn" data-value="annual">
              Fatturazione Annuale
              <span class="price">99.00€</span>
            </div>
          </div>
        </div>

        <!-- Opzioni di pagamento -->
        <div class="mb-4">
          <h4>Metodo di pagamento</h4>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="payment_method" id="credit_card" value="credit_card" checked>
            <label class="form-check-label" for="credit_card">
              Pagamento con Carta
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="payment_method" id="paypal" value="paypal">
            <label class="form-check-label" for="paypal">
              Pagamento con PayPal
            </label>
          </div>
        </div>

        <div id="credit_card_form" class="payment-form">
          <h4>Dettagli della carta</h4>
          <form id="payment-form" action="/process_payment" method="post">
            <div id="card-element"><!-- Stripe.js injects the Card Element --></div>
            <input type="hidden" name="amount" id="amount" value="999"> <!-- Default to monthly amount -->
            <button id="submit" class="btn btn-primary mt-3">Paga</button>
            <div id="card-errors" role="alert"></div>
          </form>
        </div>
        
        <!-- Pulsante di pagamento PayPal -->
        <div id="paypal_button" class="payment-form" style="display: none;">
          <h4>Pagamento PayPal</h4>
          <a href="https://www.paypal.com" class="btn btn-primary">Paga con PayPal</a>
        </div>
      </div>

      <!-- Separatore verticale -->
      <div class="col-md-1">
        <div class="btn-separator"></div>
      </div>

      <!-- Parte destra: Resoconto del pagamento -->
      <div class="col-md-3">
        <h2>Resoconto</h2>
        <div class="border p-3 mb-3">
          <h4>Piano MyDrive</h4>
          <p><strong><%= @plan == 'premium' ? 'Premium' : 'Free' %></strong></p>
          <h5>Totale</h5>
          <p id="total_amount">9.99€</p>
          <%= form_with url: payment_complete_path, method: :post do |form| %>
            <%= form.hidden_field :plan, value: @plan %>
            <%= form.submit 'Paga', class: 'btn btn-primary' %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript per gestire la visibilità del form di pagamento e la selezione dei pulsanti -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    $(document).ready(function() {
      // Gestione della selezione dei pulsanti di frequenza
      $('.btn-toggle').click(function() {
        $('.btn-toggle').removeClass('active');
        $(this).addClass('active');
        var selectedFrequency = $(this).data('value');
        var total = selectedFrequency === 'monthly' ? '9.99€' : '99.00€';
        $('#total_amount').text(total);
        $('#amount').val(selectedFrequency === 'monthly' ? '999' : '9900'); // Update amount value
      });

      // Mostra/Nascondi form di pagamento e aggiorna il totale
      $('input[name="payment_method"]').change(function() {
        if ($(this).val() === 'credit_card') {
          $('#credit_card_form').show();
          $('#paypal_button').hide();
        } else if ($(this).val() === 'paypal') {
          $('#credit_card_form').hide();
          $('#paypal_button').show();
        }
      });

      // Imposta il valore predefinito per la frequenza di pagamento
      $('.btn-toggle').first().click(); // Clicca il primo pulsante per impostare il totale iniziale

      // Stripe 
      var stripe = Stripe('<%= Figaro.env.stripe_publishable_key %>');
      var elements = stripe.elements();
      var cardElement = elements.create('card');
      cardElement.mount('#card-element');

      var form = document.getElementById('payment-form');
      form.addEventListener('submit', function(event) {
        event.preventDefault();

        stripe.createToken(cardElement).then(function(result) {
          if (result.error) {
            var errorElement = document.getElementById('card-errors');
            errorElement.textContent = result.error.message;
          } else {
            stripeTokenHandler(result.token);
          }
        });
      });

      function stripeTokenHandler(token) {
        var form = document.getElementById('payment-form');
        var hiddenInput = document.createElement('input');
        hiddenInput.setAttribute('type', 'hidden');
        hiddenInput.setAttribute('name', 'stripeToken');
        hiddenInput.setAttribute('value', token.id);
        form.appendChild(hiddenInput);
        form.submit();
      }
    });
  </script>