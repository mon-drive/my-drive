<% if notice %>
  <div class="alert alert-info">
    <%= notice %>
  </div>
<% end %>

<% if alert %>
  <div class="alert alert-danger">
    <%= alert %>
  </div>
<% end %>

<% content_for :navbar_custom_content do %>
  <div class="navbar-nav w-100 d-flex justify-content-between align-items-center">
    <div class="d-flex flex-grow-1 justify-content-center">
      <form id="search-form" class="d-flex" action="<%= dashboard_path %>" method="get" style="width: 50%;">
        <div class="input-group">
          <span class="input-group-text" id="search-icon">
            <i class="bi bi-search"></i>
          </span>
          <input id="search-input" class="form-control" type="search" placeholder="Search" name="search" aria-label="Search">
        </div>
      </form>
    </div>
    
    <div class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-person-circle"></i>
      </a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
        <li><a class="dropdown-item" href="<%= settings_path %>">Impostazioni</a></li>
        <li><a class="dropdown-item" href="<%= signout_path %>">Esci</a></li>
      </ul>
    </div>

    <%= link_to 'Premium', payment_path(plan: 'premium'), class: 'nav-link' %>
    
  </div>
<% end %>

<div class="container-fluid">
  <div class="row">
  <div class="col-md-2">
    <!-- 
        This code represents the dashboard view for a file management system. It displays a folder tree structure with links to navigate through the folders.

        The code iterates through the @items collection and filters out folders using the 'application/vnd.google-apps.folder' mime type. For each folder, it generates a list item with a folder icon, folder name, and a toggle button to show/hide the folder contents.

        The folder contents are displayed in a nested list format. It filters out subfolders that belong to the current folder and generates list items for each subfolder.

        The @current_folder and @parent_folder variables are used to determine the current folder and its parent folder, respectively. If the current folder is not the root folder, links to the root folder and parent folder are also displayed.

        Note: This code assumes the presence of the @items, @current_folder, and @parent_folder variables in the corresponding controller action.
        -->
        <div id="folderTree" class="list-group">
          <% if @current_folder != 'root' %>
            <% if @parent_folder and @parent_folder.name != @root_folder_name %>
              <%= link_to @root_folder_name, dashboard_path(folder_id: 'root'), class: 'list-group-item list-group-item-action' %>
            <% end %>
            <% if @parent_folder %>
              <%= link_to @parent_folder.name, dashboard_path(folder_id: @parent_folder.id), class: 'list-group-item list-group-item-action' %>
            <% else %>
              <%= link_to @root_folder_name, dashboard_path(folder_id: 'root'), class: 'list-group-item list-group-item-action' %>
            <% end %>
          <% end %>

          <% @items.select { |item| item.mime_type == 'application/vnd.google-apps.folder' }.each do |folder| %>
            <div class="list-group-item list-group-item-action folder-item">
              <div class="d-flex align-items-center">
                <i class="bi bi-folder-fill fs-3 me-2"></i>
                <%= link_to folder.name, dashboard_path(folder_id: folder.id), class: 'text-dark w-100' %>
                <button class="btn btn-link folder-toggle" type="button">
                  <i class="bi bi-chevron-down ms-2"></i>
                </button>
              </div>
              <div class="folder-contents" style="display: none;">
                <% @all_items.select { |item| item.parents.include?(folder.id) && item.mime_type == 'application/vnd.google-apps.folder' }.each do |subfolder| %>
                  <div class="list-group-item list-group-item-action">
                    <i class="bi bi-folder-fill fs-3 me-2"></i>
                    <%= link_to subfolder.name, dashboard_path(folder_id: subfolder.id), class: 'text-dark w-100' %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>

  </div>
  <div class="col-md-10">
    <h3>Contents of: <%= @current_folder_name %></h3>
    <div class="row">
      <% @items.each do |item| %>
        <div class="col-md-3">
          <div class="card mb-4 shadow-sm">
            <div class="card-body text-center position-relative">
              <% if item.mime_type == 'application/vnd.google-apps.folder' %>
                <%= link_to dashboard_path(folder_id: item.id), class: 'text-decoration-none text-dark' do %>
                  <i class="bi bi-folder-fill fs-3 mb-2"></i>
                  <h5 class="card-title" id="item-name-<%= item.id %>"><%= item.name %></h5>
                <% end %>
              <% else %>
                <i class="bi bi-file-earmark-text fs-3 mb-2"></i>
                <h5 class="card-title" id="item-name-<%= item.id %>"><%= item.name %></h5>
              <% end %>

              <!-- Dropdown menu -->
              <div class="dropdown position-absolute top-0 end-0 mt-2 me-2">
                <button class="btn btn-link dropdown-toggle p-0" type="button" id="dropdownMenu<%= item.id %>" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu<%= item.id %>">
                  <% if item.mime_type == 'application/vnd.google-apps.folder' %>
                    <li><%= link_to 'Apri', dashboard_path(folder_id: item.id), class: 'dropdown-item' %></li>
                  <% end %>
                  <li><a href="javascript:void(0);" class="dropdown-item rename-item" data-id="<%= item.id %>">Rinomina</a></li>
                  <li><a href="javascript:void(0);" class="dropdown-item share-item" data-id="<%= item.id %>">Condividi</a></li>
                  <li><a href="javascript:void(0);" class="dropdown-item export-item" data-id="<%= item.id %>">Esporta</a></li>
                  <li><a href="javascript:void(0);" class="dropdown-item properties-item" data-id="<%= item.id %>">Propriet√†</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>


</div>

  </div>
</div>

</div>

<style>
  .card-body i {
    display: block;
    margin-bottom: 0.5rem;
  }

  .card-body h5 {
    font-size: 1rem;
    margin-bottom: 0;
  }

  .folder-toggle {
    display: flex;
    align-items: center;
    background: none;
    border: none;
    padding: 0;
    margin-left: auto;
  }

  .folder-contents {
    padding-left: 20px;
    margin-top: 5px;
  }

  /* Rimuove la freccia verso il basso dai pulsanti dropdown-toggle */
  .dropdown-toggle::after {
    display: none;
  }
  /* Rimuove la freccia verso il basso dai pulsanti dropdown-toggle */
  .dropdown-toggle::after {
    display: none;
  }
</style>





<%= form_with url: '/upload', local: true, multipart: true do |form| %>
  <%= form.file_field :file %>
  <%= form.submit 'Upload to Google Drive' %>
<% end %>
